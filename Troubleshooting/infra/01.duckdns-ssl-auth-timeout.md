# [Troubleshooting] DuckDNS 환경에서의 HTTPS(SSL) 인증 및 가용성 문제 해결

## 1. 문제 상황 (Issue)

* **환경**: 유동 IP 환경의 Raspberry Pi 4B 서버를 외부(AWS Lambda)와 통신시키기 위해 `DuckDNS`와 공유기 포트포워딩을 이용해 배포 중이었습니다.
* **현상**:
1. 외부 데이터 전송 보안을 위해 HTTPS(SSL) 인증이 필수적이었으나,  DuckDNS는 자체적인 SSL 인증서 관리 기능을 제공하지 않아 사용자가 직접 Certbot 등을 통해 인증서를 발급받아야 했으며, 이 과정에서 DuckDNS 서버의 불완전한 DNS 응답(CAA Timeout)으로 인해 발급 난관이 발생했습니다.
2. 인증 과정 중 `DuckDNS` 서버 자체가 자주 다운되는 것을 확인했습니다. 외부 요청을 서버로 연결해 주는 핵심 관문이기 때문에 인프라 전체의 안정성에 심각한 리스크를 확인했습니다.



## 2. 원인 분석 (Root Cause)

1. **인증 메커니즘 부재**: 무료 DDNS 서비스의 특성상 SSL 인증서 발급을 위한 DNS 챌린지나 HTTP 챌린지 수행 시 안정적인 레코드 갱신이 보장되지 않았습니다.
2. **인프라 불안정성**: `DuckDNS` 서버의 잦은 중단으로 인해 Let's Encrypt 인증서 발급 시 필요한 서버 응답(80 포트)을 제때 받지 못해 타임아웃(Timeout) 에러가 발생했습니다.

```text
Saving debug log to /var/log/letsencrypt/letsencrypt.log
Requesting a certificate for duck_dns_도메인_주소.org

Certbot failed to authenticate some domains (authenticator: nginx). The Certificate Authority reported these problems:
  Domain: duck_dns_도메인_주소.org
  Type:   dns
  Detail: While processing CAA for duck_dns_도메인_주소.org: DNS problem: query timed out looking up CAA for duck_dns_도메인_주소.org

Hint: The Certificate Authority failed to verify the temporary nginx configuration changes made by Certbot. Ensure the listed domains point to this nginx server and that it is accessible from the internet.

Some challenges have failed.

Ask for help or search for solutions at https://community.letsencrypt.org. See the logfile /var/log/letsencrypt/letsencrypt.log or re-run Certbot with -v for more details.
```


## 3. 해결 과정 (Step-by-Step)

1. **포트 개방**: 공유기 설정에서 80(HTTP) 및 443(HTTPS) 포트를 개방하여 외부 통신이 가능하도록 포트포워딩을 설정했습니다.
2. **Certbot 활용**: `Certbot`과 Let's Encrypt를 활용하여 수동으로 SSL 인증서 발급을 시도했습니다.
3. **가용성 모니터링**: `DuckDNS` 서버가 살아있는 시점을 파악하기 위해 지속적으로 서버 상태를 체크했으며, 약 30분 후후 서버가 복구된 시간을 이용해 인증서 발급을 성공시켰습니다.
4. **보안 로그 모니터링**: 포트 개방 후 디스코드 웹훅(Webhook)을 통해 수집된 로그를 분석하여 무차별적인 봇 공격이 발생하고 있음을 실시간으로 감지했습니다.

## 4. 결과 및 교훈 (Lessons Learned)

* **결과**: 우여곡절 끝에 HTTPS 인증을 완료하여 보안 통신을 구현했으나, 외부 노출 포트를 통한 봇 공격과 DDNS 서버의 불안정성이라는 근본적인 한계를 확인했습니다.
* **교훈**:
* 엔지니어는 기능 구현(HTTPS 성공)뿐만 아니라 **시스템의 가용성(Availability)**과 **보안(Security)**을 동시에 고려해야 함을 깊이 체감했습니다.
* 이 경험은 이후 포트 개방 없이 안전한 터널을 형성하는 **Cloudflare Tunnel**로 아키텍처를 전면 개편하는 결정적 계기가 되었습니다.