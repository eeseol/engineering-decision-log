# [ADR] RAG Vector DB로 Qdrant Cloud(Free Tier) 도입

## 1. 배경 (Context)
* 기존 서비스는 **MongoDB에 수집한한 데이터**를 저장하고 있습니다.
* 서비스 완성도를 높이기 위해 **RAG(검색 증강 생성)** 기능을 도입하려고 했고, 이를 위해 **벡터 검색(Vector Search)** 저장소가 필요했습니다.
* 현재 서비스는 트래픽이 크지 않아, 초기에는 **비용을 최소화하면서 빠르게 적용 가능한 벡터 DB**가 우선순위였습니다.

---

## 2. 문제 분석 (Problem Analysis)
* 벡터 검색을 구현하기 위해 다음 조건을 만족해야 했습니다.

1. **비용 최소화**
   - 현재 사용량이 적어 초기 비용이 거의 0에 가까운 구성이 필요함.
2. **구축/운영 리스크 최소화**
   - 1인 개발 환경이므로, 운영 복잡도가 큰 구성(OpenSearch 등)은 부담이 큼.
3. **기존 MongoDB와의 역할 분리**
   - MongoDB에는 원본/운영 데이터를 유지하고,
   - 벡터 DB에는 파생 데이터(embedding)를 별도 관리하는 구조가 바람직함.
4. **데이터 증가 시 확장 가능성**
   - 초기에는 작게 시작하되, 필요 시 스케일업/마이그레이션이 쉬워야 함.

---

## 3. 고려한 대안 (Alternatives)
### 1) MongoDB Vector Search (Atlas)
* 장점
  - 기존 DB 그대로 확장 가능 (운영 단순)
  - 단일 DB로 관리 가능
* 단점
  - 벡터 검색을 위한 Atlas 플랜/인덱스 비용 증가 가능성
  - 데이터 누적 시 비용이 빠르게 커질 수 있다는 리스크

### 2) OpenSearch (Vector Search)
* 장점
  - 검색/필터링/벡터를 통합 운영 가능
  - 대규모 확장에 강함
* 단점
  - 현 서비스 규모 대비 과한 구성
  - 운영/비용 부담이 큼 (데모 단계에서 오버스펙)

### 3) pgvector (PostgreSQL 확장)
* 장점
  - 관계형 DB 기반의 안정적 운영 가능
  - 인덱스/트랜잭션/쿼리 활용성이 높음
* 단점
  - 기존 MongoDB와 별도로 PostgreSQL 운영 필요 (DB 2개 관리)
  - 백업/모니터링/권한/배포 관리 대상이 늘어남

### 4) Qdrant 자가호스팅 (On-Premise)
* 장점
  - 비용 거의 0에 가까운 운영 가능
  - 시스템 제어권 확보
* 단점
  - 라즈베리파이 환경(USB 16GB, RAM 4GB)에서는 저장공간/메모리 한계 가능성
  - 장애 대응/백업/업그레이드 등 운영 책임이 1인에게 집중됨

### 5) Qdrant Cloud (Free Tier)
* 장점
  - 빠른 적용 및 운영 부담 최소화
  - 벡터 검색 기능이 RAG에 최적화되어 있음 (필터링/스코어/컬렉션 관리)
  - 초기 비용이 거의 0에 가까움 (무료 티어 제공)
* 단점
  - 무료 티어 저장 공간에 한계가 있어, 데이터가 증가하면 플랜 업그레이드 필요
  - 외부 서비스 의존성 존재

---

## 4. 최종 결정 (Decision)
**Qdrant Cloud Free Tier를 RAG Vector DB로 우선 도입**

* 초기에는 Qdrant Cloud 무료 용량으로 운영하며,
* 사용량 증가/비용 상승 시점에 맞춰 아래 옵션을 검토합니다.
  - Qdrant Cloud 상위 플랜 업그레이드
  - On-Premise(Qdrant 자가호스팅)로 이전
  - pgvector 또는 OpenSearch로 마이그레이션

---

## 5. 기대 효과 (Consequences)
* **비용 최적화**
  - 데모 단계에서 벡터 검색을 거의 무료로 운영 가능
* **개발 속도 향상**
  - 인프라 구축 없이 즉시 RAG 적용 가능 (PoC 속도↑)
* **운영 리스크 감소**
  - 1인 개발 환경에서 벡터 DB 운영 부담을 최소화
* **마이그레이션 용이**
  - 벡터 DB는 파생 데이터(embedding)이므로,
    필요 시 MongoDB 원본 기반으로 재생성하여 다른 DB로 이전 가능
